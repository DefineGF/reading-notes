## 数据页

一个 InnoDB 数据页的存储空间：

![image-20230920143413851](./image-20230920143413851-1695191658566-1.png)

##### 创建表：

```sql
create table page_demo (
	c1 INT,
    c2 INT,
    c3 VARCHAR(10000),
    primary key(c1)
) charset=ascii row_format=Compact;
```

##### 行格式：

![image-20230920144214305](./image-20230920144214305-1695192136716-3.png)

含义如下：

![image-20230920144316738](./image-20230920144316738.png)

- delete_mask：被删除掉的记录都会组成一个所谓的 垃圾链表 ，在这个链表中的记录占用的空间称之为所谓的 可重用空间 ，之后如果有

  新记录插入到表中的话，可能把这些被删除的记录占用的存储空间覆盖掉；

- heap_no：表示当前记录在本 页 中的位置；系统自动给每个页里边儿加了两个记录，有时候也称为 伪记录 或者 虚拟记录 。这两个伪记录一个代表 最小记录 ，一个代表 最大记录；

- next_record：从当前记录的真实数据到下一条记录的真实数据的地址偏移量；**Infimum**记录（也就是最小记录） 的下一条记录就是

  本页中主键值最小的用户记录，而本页中主键值最大的用户记录的下一条记录就是 **Supremum**记录（也就是最大记录）；

#### 文件头部

![image-20230920155306183](./image-20230920155306183.png)



#### 页面头部

结构如下：

![image-20230920155142010](./image-20230920155142010.png)



#### 页目录

![image-20230920155437859](./image-20230920155437859-1695196480217-5.png)

##### 特点

- 最小记录所在的分组只能有 **1** 条记录；最大记录所在的分组拥有的记录条数只能在 **1~8** 条之间，剩下的分组中记录的条数范围只能在是 **4~8** 条之间；

- 所有正常的记录（包括最大和最小记录，不包括标记为已删除的记录）划分为几个组；
-  每个组的最后一条记录（也就是组内最大的那条记录）的头信息中的 n_owned 属性表示该组内共有几条记录；
-  将每个组的最后一条记录的**地址偏移量**单独提取出来按顺序存储到靠近 页 的尾部的地方；

##### 工作过程

1. 初始情况下一个数据页里只有最小记录和最大记录两条记录，它们分属于两个分组；
2. 之后每插入一条记录，都会从 页目录 中找到主键值比本记录的主键值大并且差值最小的槽，然后把该槽对应的记录的 n_owned 值加1，表示本组内又添加了一条记录，直到该组中的记录数等于8个；
3. 在一个组中的记录数等于8个后再插入一条记录时，会将组中的记录拆分成两个组，一个组中4条记录，另一个5条记录。这个过程会在 页目录 中新增一个 槽 来记录这个新增分组中最大的那条记录的偏移量；

然后查找的时候，就可以使用 二分法 对槽进行查找；



