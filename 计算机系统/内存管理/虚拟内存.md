### 虚拟存储器

OS将所需要的部分调入内存，然后继续执行程序；将内存中暂不需要的内容换出到外存；

系统提供了：部分装入；请求调入；置换功能

##### 特征：

- 多次性：允许将一个作业多次调入内存；
- 对唤性；
- 虚拟性；

##### 硬件支持

- 一定容量的内存和外存；
- 页表机制；
- 中断机构；
- 地址变换机构；





#### 请求分页存储管理

页式虚拟存储器

- 仅装入当前要执行的部分页面即可，执行中请求调用；

- 页表项：（页号）：
    - 物理块号；
    - 状态位（有效位，是否装入内存）；
    - 访问字段（用于置换算法）；
    - 修改位（脏位,记录是否被修改过）；虚拟机制采用写回策略

虚拟地址空间 > 物理存储空间 （不然为何虚拟）

##### 中断机制

当要访问的页面不在内存时，便产生一个缺页中断，请求操作系统调入所缺页入内存；此时缺页进程阻塞；

- 在指令执行期间而非指令执行完候产生和处理中断信号，属于内部中断；
- 一条指令执行期间，可产生多次中断；



##### 地址转换

1. 先检索快表，若找到要访问的页，则修改页表项中的访问位（写指令还要重置修改位），

    然后利用页表项中给出的物理块号和页内地址形成物理地址；

2. 若未在快表中找到页表项，则应到内存中查找页表，再对比页表项中的状态位P，看该页是否调入内存；

    未调入则产生缺页中断，请求从外存中调入；



##### 页面置换算法

- 最佳（OPT）置换算法

    以后永不使用的页面，无法实现；

- 先进先出（FIFO）算法

    会产生分配的物理块号增大而页故障数不减反增的异常现象；称之为 Belady；

- 最近最久未使用（LRU）算法

    最近最长时间未访问过的页面予以淘汰；

- 时钟（Clock）置换算法

    改进型CLOCK置换算法（访问位 + 修改位），淘汰顺序如下：

    - 0 0 
    - 0 1 
    - 1 0
    - 1 1

##### 页面分配策略

- 固定分配局部置换

    进程分配一定数目的物理块；

- 可变分配全局置换

    操作系统自身维持一个空闲物理块队列；（存在盲目的给进程分配物理块）

- 可变分配局部置换

    每个进程分配一定数目的物理块，可以根据缺页情况进行响应调整；

何时：

- 预调页策略；
- 请求调页策略；

何处：

外存分为两部分：存放文件的文件区（离散分配方式）；存放对换页面的对换区（连续分配方式）；

- 系统拥有足够的对换区：可以全部从对换区调入所需页面；

- 系统缺少足够的对换区：不会修改的文件从文件区调入（未被修改则无需换出）；对于可能修改的部分，换出时需要换入的对换区；

- UNIX：与进程有关的文件都放在对换区，未运行过的页面都应从文件区调入；

    曾经运行过但被换出的页面，放入对换区（下次调入从对换区调入）



##### 工作集 & 驻留集

- 给一个进程分配的物理页框的集合就是这个进程的驻留集；
- 工作集：当前页面 与之前的 工作集窗口 大小的 集合；

OS跟踪每个进程的工作集，并为进程分配大于其工作集的物理块；

落在工作集内的物理块调入驻留集，落在工作集外的物理块调出驻留集