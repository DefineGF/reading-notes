### CAP 理论

##### 一致性（Consistency）：

一致性指的是在分布式系统中，所有节点在同一时刻对数据的访问都能看到相同的数据副本。即使分布式系统中存在多个副本，但通过一致性机制（如同步复制）可以保证数据的一致性。

在CAP理论中，要求一致性意味着系统必须在任何时候都返回最新的数据或错误。



##### 可用性（Availability）：

可用性指的是系统在面对用户请求时能够及时返回合理的响应，即系统保持正常运行、对外提供服务。

在CAP理论中，要求可用性意味着系统必须能够在有限时间内响应客户端请求，即使在面对网络故障或部分节点失效的情况下也要保持可用。

> 每次请求都能获取到正确的响应，但是不保证获取的数据为最新数据



##### 分区容错性（Partition tolerance）：

分区容错性指的是系统能够在面对网络分区时继续运行，即系统能够将节点分成多个分区并保证每个分区内的节点可以正常通信，即使分区之间无法通信。

在CAP理论中，要求分区容错性意味着系统必须能够处理网络分区导致的消息丢失或延迟



#### zookeeper 之 cp

##### 为什么选择 cp

> 1. 一致性要求：ZooKeeper通常被用作分布式系统中的协调服务，用于管理配置信息、命名服务、分布式锁等。在这些应用中，数据的一致性是非常重要的。ZooKeeper保证了分布式系统中的所有节点对数据的读写操作都具有强一致性。
> 2. 强一致性模型：ZooKeeper采用了基于ZAB（ZooKeeper Atomic Broadcast）协议的原子广播算法，确保了数据在所有节点上的一致性。ZAB协议中的顺序广播机制保证了所有节点按照相同的顺序接收和应用更新操作，从而实现了强一致性。
> 3. 分区容错性：ZooKeeper设计为具备高度的分区容错性，即使在网络分区的情况下，仍然能够保持系统的可用性。当发生网络分区时，ZooKeeper的每个节点仍然可以继续提供读写服务，并维护数据的一致性。一旦网络分区恢复，ZooKeeper会自动解决数据的一致性。
> 4. 对于许多应用来说，一致性和可靠性是更重要的：在许多分布式应用中，如分布式锁、选主算法等，一致性和可靠性往往比可用性更为重要。牺牲一部分可用性，可以确保数据的强一致性和可靠性，从而满足这些应用的需求。

为什么没有满足可用性？

1. ZooKeeper是单体应用架构,一个ZooKeeper集群只由一个Leader和多个Follower组成。如果Leader节点发生故障,Follower需要选举出新的Leader,这个过程会导致短暂的不可用期。
2. ZooKeeper的write复制是同步的,每个写操作都需要等待大多数节点确认后才返回客户端。这会导致写操作延迟比较高。
3. ZooKeeper对单点故障的容错能力较差。一个节点故障可能导致整个ZooKeeper集群不可用。
4. ZooKeeper集群规模扩容困难。随着业务规模增长,ZooKeeper节点数一旦增加,集群部署和管理就会非常复杂。
5. ZooKeeper自身无法高可用部署。例如ZooKeeper的日志存储和持久化策略会影响其可用性。