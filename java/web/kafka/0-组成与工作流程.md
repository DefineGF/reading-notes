### Kafka

#### 基本组成

1. **Producer（生产者）：** 生产者负责将数据发布到 Kafka 集群。它将数据分割为多个消息，并将这些消息发布到一个或多个主题（Topics）中。生产者可以是单个应用程序或分布式系统。
2. **Consumer（消费者）：** 消费者订阅一个或多个主题，并从 Kafka 集群中拉取数据。消费者消费发布到主题的消息，并进行相应的处理。消费者可以是单个应用程序或分布式系统。
3. **Broker（代理服务器）：** 代理服务器是 Kafka 集群的节点，负责接收和存储发布的消息，并处理来自生产者和消费者的请求。每个代理服务器都是一个独立的 Kafka 服务器，它们组成了整个 Kafka 集群。
4. **Topic（主题）：** 主题是消息的类别或流的名称。消息被发布到特定的主题，并且消费者订阅特定的主题来获取消息。主题可以分区和复制以实现高吞吐量和容错性。
5. **Partition（分区）：** 主题可以分为多个分区，每个分区是一个有序的、不可变的消息序列。分区可以分布在多个代理服务器上，以实现负载均衡和伸缩性。每个分区都有一个唯一的标识符（Partition ID）。
6. **Offset（偏移量）：** 消息在分区中的位置被称为偏移量。消费者可以通过指定偏移量来读取分区中的消息。Kafka 会为每个分区中的每条消息分配一个唯一的偏移量

##### partition和broker有什么关联

在 Kafka 中，当创建一个主题并指定需要的分区数量时，Kafka 会尽量将这些分区均匀地分配给可用的 Broker，以实现负载均衡和高可用性。

如果你创建一个主题并指定需要 4 个分区，而同时有足够的可用 Broker，Kafka 会尽量将这 4 个分区分配给不同的 Broker。这样可以确保每个 Broker 承载的负载相对均衡，并且即使其中一个 Broker 发生故障，主题的分区仍然可以继续在其他 Broker 上提供服务。

- 同一topic下的不同partition，可能分布在不同的broker上，以达到负载均衡、高吞吐量和可伸缩性的目的；

  



##### 分区读写

 生产者发送消息到特定主题的特定分区时，消息首先发送到该分区的领导者副本所在的 Broker。领导者负责接收和写入消息，并将消息复制到追随者副本。消费者从特定分区的领导者副本或可用的追随者副本读取消息。



#### 工作流程

1. **创建主题（Topic）：** 在 Kafka 集群中创建一个主题，指定主题的名称、分区数和复制因子。
2. **生产者发送消息（Producer）：** 生产者将消息发送到一个或多个主题。生产者可以选择将消息发送到特定的分区，也可以让 Kafka 自动选择分区。（同一消息只能发送到一个分区）
3. **消费者订阅主题（Consumer）：** 消费者订阅一个或多个主题，并从 Kafka 集群中拉取消息。
4. **消息存储和分发（Broker）：** **代理服务器**接收到发布的消息后，将其存储在磁盘上，并根据主题的分区规则将消息分发到相应的分区。
5. **消费者拉取消息（Consumer）：** 消费者定期从 Kafka 集群中拉取消息。消费者可以指定要拉取的分区和偏移量。
6. **消息处理和消费（Consumer）：** 消费者获取拉取到的消息，并进行相应的处理，可能是业务逻辑处理或进一步的传递。
7. **偏移量的管理（Consumer）：** 消费者跟踪已经处理的消息的偏移量，并定期将偏移量提交给 Kafka 集群。这样，即使消费者关闭或重新启动，它也可以从上次提交的偏移量继续消费



#### 相关问题

